# Day 01 - БАУ SQL

## _Первые шаги по работе с множествами и JOIN в SQL_

Загрузите [скрипт](../materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных (вы можете использовать командную строку с psql или просто запустить его через любую IDE, например DataGrip от JetBrains или pgAdmin от сообщества PostgreSQL).

![schema](../materials/schema.png)

1. **pizzeria** (Таблица-словарь с доступными пиццериями)
- id - первичный ключ (primary key)
- name - название пиццерии
- rating - средний рейтинг пиццерии (от 0 до 5 баллов)
2. **person** (Таблица-словарь с людьми, которые любят пиццу)
- id - первичный ключ
- name - имя человека
- age - возраст человека
- gender - пол человека
- address - адрес человека
3. **menu** (Таблица-словарь с доступным меню и ценой на конкретную пиццу)
- id - первичный ключ
- pizzeria_id - внешний ключ к пиццерии (foreign key)
- pizza_name - название пиццы в пиццерии
- price - цена конкретной пиццы
4. **person_visits** (Операционная таблица с информацией о посещениях пиццерии)
- id - первичный ключ
- person_id - внешний ключ к человеку
- pizzeria_id - внешний ключ к пиццерии
- visit_date - дата (например 2022-01-01) посещения человека
5. **person_order** (операционная таблица с информацией о заказах людей)
- id - первичный ключ
- person_id - внешний ключ к человеку
- menu_id - внешний ключ к меню
- order_date - дата (например 2022-01-01) заказа человека

Посещение лиц и заказ лиц являются разными сущностями и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню) и в это время сделать заказ в другом по телефону или через мобильное приложение. Или другой случай, просто быть дома и снова сделать звонок с заказом без всяких визитов.

## Упражнение 00 - Заставим UNION танцевать

Пожалуйста, напишите оператор SQL, который возвращает идентификатор меню и имена пиццы из menuтаблицы, а также идентификатор человека и имя человека из personтаблицы в одном глобальном списке (с именами столбцов, как показано в примере ниже), упорядоченными по столбцам object_id, а затем по столбцам object_name.

| object_id | object_name |
| ------ | ------ |
| 1 | Anna |
| 1 | cheese pizza |
| ... | ... |

## Упражнение 01 — танец UNION с подзапросом

Измените оператор SQL из «упражнения 00», удалив столбец `object_id`. Затем измените порядок по `object_name` для части данных из `person` таблицы, а затем из `menu` таблицы (как показано в примере ниже). Пожалуйста, сохраняйте дубликаты!

| object_name |
| ------ |
| Andrey |
| Anna |
| ... |
| cheese pizza |
| cheese pizza |
| ... |

## Упражнение 02. Дублирует или не дублирует

Пожалуйста, напишите оператор SQL, который возвращает уникальные названия пицц из `menu` таблицы и заказы по столбцу `pizza_name` в убывающем режиме.

## Упражнение 03. «Скрытые» идеи

Пожалуйста, напишите оператор SQL, который возвращает общие строки для атрибутов `order_date`, `person_id` из `person_order` таблицы с одной стороны и `visit_date`, `person_id` из `person_visits` таблицы с другой стороны (см. пример ниже). Другими словами, найдем идентификаторы лиц, которые пришли и заказали пиццу в один и тот же день. На самом деле, пожалуйста, добавьте сортировку по `action_date` в порядке возрастания, а затем по `person_id` в порядке убывания.

| action_date | person_id |
| ------ | ------ |
| 2022-01-01 | 6 |
| 2022-01-01 | 2 |
| 2022-01-01 | 1 |
| 2022-01-03 | 7 |
| 2022-01-04 | 3 |
| ... | ... |

## Упражнение 04. Разница? Да, давайте найдем разницу между мультимножествами.

Пожалуйста, напишите оператор SQL, который возвращает разницу (минус) значений столбца `person_id` с сохранением дубликатов между `person_order` таблицей и `person_visits` таблицей для `order_date` и `visit_date` на 7 января 2022 года.

## Упражнение 05. Вы слышали о декартовом произведении?

Напишите оператор SQL, который возвращает все возможные комбинации между таблицами `person` и `pizzeria` и установите порядок по идентификатору человека, а затем по столбцу идентификатора пиццерии. Пожалуйста, взгляните на образец результата ниже. Имейте в виду, что имена столбцов могут отличаться для вас.

| person.id | person.name | age | gender | address | pizzeria.id | pizzeria.name | rating |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| 1 | Anna | 16 | female | Moscow | 1 | Pizza Hut | 4.6 |
| 1 | Anna | 16 | female | Moscow | 2 | Dominos | 4.3 |
| ... | ... | ... | ... | ... | ... | ... | ... |

## Упражнение 06. Давайте посмотрим на «скрытые» идеи

Давайте вернемся к упражнению № 03 и изменим нашу инструкцию SQL, чтобы она возвращала имена людей вместо идентификаторов людей, и изменим порядок на `action_date` в возрастающем режиме, а затем на `person_name` в нисходящем режиме. Пожалуйста, взгляните на образец данных ниже.

| action_date | person_name |
| ------ | ------ |
| 2022-01-01 | Irina |
| 2022-01-01 | Anna |
| 2022-01-01 | Andrey |
| ... | ... |

## Упражнение 07. Просто сделайте JOIN

Пожалуйста, напишите оператор SQL, который возвращает дату заказа из `person_order` таблицы и соответствующее имя человека (имя и возраст имеют формат, как в примере данных ниже), который сделал заказ из `person` таблицы. Добавьте сортировку по обоим столбцам в возрастающем режиме.

| order_date | person_information |
| ------ | ------ |
| 2022-01-01 | Andrey (age:21) |
| 2022-01-01 | Andrey (age:21) |
| 2022-01-01 | Anna (age:16) |
| ... | ... |

## Упражнение 08. Перенос JOIN в NATURAL JOIN

Пожалуйста, перепишите оператор SQL из упражнения № 07, используя конструкцию NATURAL JOIN. Результат должен быть таким же, как в упражнении №07.

## Упражнение 09. ВНУТРИ и СУЩЕСТВУЮЩИЕ

Пожалуйста, напишите 2 оператора SQL, которые возвращают список названий пиццерий, которые не посещались людьми, используя IN для 1-го и EXISTS для 2-го.

## Упражнение 10. Глобальное соединение

Пожалуйста, напишите оператор SQL, который возвращает список имен людей, сделавших заказ на пиццу в соответствующей пиццерии. Пример результата (с именованными столбцами) представлен ниже, и да... пожалуйста, упорядочьте по 3 столбцам в возрастающем режиме.

| person_name | pizza_name | pizzeria_name |
| ------ | ------ | ------ |
| Andrey | cheese pizza | Dominos |
| Andrey | mushroom pizza | Dominos |
| Anna | cheese pizza | Pizza Hut |
| ... | ... | ... |
