# Day 02 - Бассейн SQL

## _Подробное изучение JOIN в SQL_

Загрузите [скрипт](../materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных (вы можете использовать командную строку с psql или просто запустить его через любую IDE, например DataGrip от JetBrains или pgAdmin от сообщества PostgreSQL).

![schema](../materials/schema.png)

1. **pizzeria** (Таблица-словарь с доступными пиццериями)
- id - первичный ключ (primary key)
- name - название пиццерии
- rating - средний рейтинг пиццерии (от 0 до 5 баллов)
2. **person** (Таблица-словарь с людьми, которые любят пиццу)
- id - первичный ключ
- name - имя человека
- age - возраст человека
- gender - пол человека
- address - адрес человека
3. **menu** (Таблица-словарь с доступным меню и ценой на конкретную пиццу)
- id - первичный ключ
- pizzeria_id - внешний ключ к пиццерии (foreign key)
- pizza_name - название пиццы в пиццерии
- price - цена конкретной пиццы
4. **person_visits** (Операционная таблица с информацией о посещениях пиццерии)
- id - первичный ключ
- person_id - внешний ключ к человеку
- pizzeria_id - внешний ключ к пиццерии
- visit_date - дата (например 2022-01-01) посещения человека
5. **person_order** (операционная таблица с информацией о заказах людей)
- id - первичный ключ
- person_id - внешний ключ к человеку
- menu_id - внешний ключ к меню
- order_date - дата (например 2022-01-01) заказа человека

Посещение лиц и заказ лиц являются разными сущностями и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню) и в это время сделать заказ в другом по телефону или через мобильное приложение. Или другой случай, просто быть дома и снова сделать звонок с заказом без всяких визитов.

## Упражнение 00 - Двигайтесь ВЛЕВО, двигайтесь ВПРАВО

Пожалуйста, напишите оператор SQL, который возвращает список названий пиццерий с соответствующим значением рейтинга, которые не посещались людьми.

## Упражнение 01. Найдите пробелы в данных

Пожалуйста, напишите оператор SQL, который возвращает пропущенные дни с 1 по 10 января 2022 года (включая все дни) для посещений лиц с идентификаторами 1 или 2. Упорядочьте по дням посещения по возрастанию. Образец данных с именем столбца представлен ниже.

| missing_date |
| ------ |
| 2022-01-03 |
| 2022-01-04 |
| 2022-01-05 |
| ... |

## Упражнение 02. FULL означает «полностью заполненный».

Пожалуйста, напишите оператор SQL, который возвращает полный список имен людей, посетивших (или не посещенных) пиццерии в период с 1 по 3 января 2022 года с одной стороны, и весь список имен пиццерий, которые были посещены (или не посещены) с другой стороны. Обратная сторона. Образец данных с необходимыми именами столбцов представлен ниже. Обратите внимание на значение замены «-» для `NULL` значений в столбцах `person_name` и `pizzeria_name`. Пожалуйста, также добавьте порядок для всех 3 столбцов.

| person_name | visit_date | pizzeria_name |
| ------ | ------ | ------ |
| - | null | DinoPizza |
| - | null | DoDo Pizza |
| Andrey | 2022-01-01 | Dominos |
| Andrey | 2022-01-02 | Pizza Hut |
| Anna | 2022-01-01 | Pizza Hut |
| Denis | null | - |
| Dmitriy | null | - |
| ... | ... | ... |

## Упражнение 03. Преобразование в CTE

Вернемся к упражнению № 01. Пожалуйста, перепишите свой SQL, используя шаблон CTE (Common Table Expression). Пожалуйста, перейдите в часть CTE вашего "дневного генератора". Результат должен быть таким же, как в упражнении № 01.

| missing_date |
| ------ |
| 2022-01-03 |
| 2022-01-04 |
| 2022-01-05 |
| ... |

## Упражнение 04. Найдите любимую пиццу

Найдите полную информацию обо всех возможных названиях пиццерий и ценах, чтобы получить пиццу с грибами или пепперони. Затем отсортируйте результат по названию пиццы и названию пиццерии. Результат выборки данных приведен ниже (пожалуйста, используйте те же имена столбцов в своем операторе SQL).

| pizza_name | pizzeria_name | price |
| ------ | ------ | ------ |
| mushroom pizza | Dominos | 1100 |
| mushroom pizza | Papa Johns | 950 |
| pepperoni pizza | Best Pizza | 800 |
| ... | ... | ... |

## Упражнение 05. Исследование личных данных

Найдите имена всех лиц женского пола старше 25 лет и упорядочите результат по имени. Образец вывода представлен ниже.

| name   |
|--------|
| Elvira |
| ...    |

## Упражнение 06 - Любимые пиццы Дениса и Анны

Пожалуйста, найдите все названия пицц (и соответствующие названия пиццерий с помощью `menu` таблицы), которые заказывали Денис или Анна. Отсортируйте результат по обоим столбцам. Образец вывода представлен ниже.

| pizza_name | pizzeria_name |
| ------ | ------ |
| cheese pizza | Best Pizza |
| cheese pizza | Pizza Hut |
| ... | ... |

## Упражнение 07 - Самая дешевая пиццерия для Дмитрия

Найдите, пожалуйста, название пиццерии, которую Дмитрий посетил 8 января 2022 года и смог съесть пиццу менее чем за 800 рублей.

## Упражнение 08. Продолжаем исследовать данные

Пожалуйста, найдите имена всех мужчин из Москвы или Самары, которые заказывают либо пепперони, либо грибную пиццу (или и то, и другое). Упорядочить результат по имени человека в порядке убывания. Образец вывода представлен ниже.

| name |
|------|
| Dmitriy |
| ... |

## Упражнение 09. Кто любит сыр и пепперони?

Пожалуйста, найдите имена всех женщин, которые заказывали и пепперони, и сырную пиццу (в любое время и в любых пиццериях). Убедитесь, что результат упорядочен по имени человека. Образец данных представлен ниже.


| name |
|------|
| Anna |
| ...  |

## Упражнение 10. Найдите людей из одного города

Пожалуйста, найдите имена людей, которые живут по тому же адресу. Убедитесь, что результат упорядочен по имени 1-го лица, имени 2-го лица и общему адресу. Образец данных представлен ниже. Пожалуйста, убедитесь, что ваши имена столбцов соответствуют именам столбцов ниже.

| person_name1 | person_name2 | common_address |
| ------ | ------ | ------ |
| Andrey | Anna | Moscow |
| Denis | Kate | Kazan |
| Elvira | Denis | Kazan |
| ... | ... | ... |