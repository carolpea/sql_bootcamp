# Day 03 - Бассейн SQL

## _Продолжаем ПРИСОЕДИНЯТЬСЯ и вносим изменения в данные_

Загрузите [скрипт](../materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных (вы можете использовать командную строку с psql или просто запустить его через любую IDE, например DataGrip от JetBrains или pgAdmin от сообщества PostgreSQL).

![schema](../materials/schema.png)

1. **pizzeria** (Таблица-словарь с доступными пиццериями)
- id - первичный ключ (primary key)
- name - название пиццерии
- rating - средний рейтинг пиццерии (от 0 до 5 баллов)
2. **person** (Таблица-словарь с людьми, которые любят пиццу)
- id - первичный ключ
- name - имя человека
- age - возраст человека
- gender - пол человека
- address - адрес человека
3. **menu** (Таблица-словарь с доступным меню и ценой на конкретную пиццу)
- id - первичный ключ
- pizzeria_id - внешний ключ к пиццерии (foreign key)
- pizza_name - название пиццы в пиццерии
- price - цена конкретной пиццы
4. **person_visits** (Операционная таблица с информацией о посещениях пиццерии)
- id - первичный ключ
- person_id - внешний ключ к человеку
- pizzeria_id - внешний ключ к пиццерии
- visit_date - дата (например 2022-01-01) посещения человека
5. **person_order** (операционная таблица с информацией о заказах людей)
- id - первичный ключ
- person_id - внешний ключ к человеку
- menu_id - внешний ключ к меню
- order_date - дата (например 2022-01-01) заказа человека

Посещение лиц и заказ лиц являются разными сущностями и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню) и в это время сделать заказ в другом по телефону или через мобильное приложение. Или другой случай, просто быть дома и снова сделать звонок с заказом без всяких визитов.

## Упражнение 00 - Найдем подходящие цены для Кати

Пожалуйста, напишите оператор SQL, который возвращает список названий пицц, цен на пиццы, названий пиццерий и дат посещения для Кати и цен в диапазоне от 800 до 1000 рублей. Сортируйте по пицце, цене и названию пиццерии. Взгляните на образец данных ниже.

| pizza_name | price | pizzeria_name | visit_date |
| ------ | ------ | ------ | ------ |
| cheese pizza | 950 | DinoPizza | 2022-01-04 |
| pepperoni pizza | 800 | Best Pizza | 2022-01-03 |
| pepperoni pizza | 800 | DinoPizza | 2022-01-04 |
| ... | ... | ... | ... |

## Упражнение 01. Найдем забытые меню

Пожалуйста, найдите все идентификаторы меню, которые никем не заказаны. Результат должен быть отсортирован по идентификаторам. Пример выходных данных представлен ниже.

| menu_id |
| ------ |
| 5 |
| 10 |
| ... |

## Упражнение 02 - Найдем забытую пиццу и пиццерию

Пожалуйста, используйте оператор SQL из упражнения № 01 и покажите названия пицц из пиццерии, которые никто не заказывал, включая соответствующие цены. Результат должен быть отсортирован по названию пиццы и цене. Пример выходных данных представлен ниже.

| pizza_name | price | pizzeria_name |
| ------ | ------ | ------ |
| cheese pizza | 700 | Papa Johns |
| cheese pizza | 780 | DoDo Pizza |
| ... | ... | ... |

## Упражнение 03. Сравним посещения

Пожалуйста, найдите объединение пиццерий, которые посещали женщины или мужчины. Другими словами, вы должны найти набор названий пиццерий, которые посещали только женщины, и выполнить операцию "СОЮЗ" с набором названий пиццерий, которые посещали только мужчины. Обратите внимание на слово «только» для обоих полов. Для любых операторов SQL с множествами сохраняйте дубликаты ( UNION ALL, EXCEPT ALL, INTERSECT ALLконструкции). Пожалуйста, отсортируйте результат по названию пиццерии. Образец данных представлен ниже.

| pizzeria_name |
| ------ |
| Best Pizza |
| Dominos |
| ... |

## Упражнение 04. Сравним заказы

Пожалуйста, найдите союз пиццерий, у которых есть заказы либо от женщин, либо от мужчин. Другими словами, вы должны найти набор названий пиццерий, заказанных только женщинами, и выполнить операцию «СОЮЗ» с набором названий пиццерий, заказанных только мужчинами. Обратите внимание на слово «только» для обоих полов. Для любых операторов SQL с наборами не сохраняются дубликаты ( UNION, EXCEPT, INTERSECT). Пожалуйста, отсортируйте результат по названию пиццерии. Образец данных представлен ниже.

| pizzeria_name |
| ------ |
| Papa Johns |

## Упражнение 05. Посетил, но не сделал никакого заказа

Пожалуйста, напишите оператор SQL, который возвращает список пиццерий, которые Андрей посещал, но не делал заказов. Пожалуйста, заказывайте по названию пиццерии. Образец данных представлен ниже.

| pizzeria_name |
| ------ |
| Pizza Hut |
| ... |

## Упражнение 06. Найдите пиццу по сходству цен

Пожалуйста, найдите одинаковые названия пиццы, которые имеют одинаковую цену, но из разных пиццерий. Убедитесь, что результат упорядочен по названию пиццы. Образец данных представлен ниже. Пожалуйста, убедитесь, что ваши имена столбцов соответствуют именам столбцов ниже.

| pizza_name | pizzeria_name_1 | pizzeria_name_2 | price |
| ------ | ------ | ------ | ------ |
| cheese pizza | Best Pizza | Papa Johns | 700 |
| ... | ... | ... | ... |

## Упражнение 07 - Давайте приготовим новый вид пиццы

Пожалуйста, зарегистрируйте новую пиццу с названием «greek pizza» (используйте id = 19) по цене 800 рублей в ресторане «Dominos» (pizzeria_id = 2).

## Упражнение 08. Давайте приготовим новый вид пиццы с большей динамикой

Пожалуйста, зарегистрируйте новую пиццу с названием «sicilian pizza» (id которой должен рассчитываться по формуле «максимальное значение id + 1») стоимостью 900 рублей в ресторане «Dominos» (используйте внутренний запрос, чтобы получить идентификатор пиццерии).

## Упражнение 09. Новая пицца означает новые посещения

Пожалуйста, зарегистрируйте новые посещения ресторана Dominos от Дениса и Ирины 24 февраля 2022 года.

## Упражнение 10. Новые посещения означают новые заказы

Пожалуйста, регистрируйте новые заказы от Дениса и Ирины на 24 февраля 2022 года на новое меню с «sicilian pizza».

## Упражнение 11 - «Улучшить» цену для клиентов

Пожалуйста, измените цену на «greek pizza» на -10% от текущей стоимости.

## Упражнение 12 - Приходят новые заказы!

- Не используйте оконные функции, такие как `ROW_NUMBER( )`
- Не используйте атомарные `INSERT` операторы |

Пожалуйста, зарегистрируйте новые заказы от всех лиц на «greek pizza» до 25 февраля 2022 года.

## Упражнение 13. Возврат денег нашим клиентам

Пожалуйста, напишите 2 оператора SQL (DML), которые удаляют все новые заказы из упражнения № 12 на основе даты заказа. Затем удалите «greek pizza» из меню.